<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - EduLedger</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #94a3b8;
            --accent-color: #f87171;
            --success-color: #34d399;
            --background-color: #0f172a;
            --text-color: #e2e8f0;
            --card-bg: #1e293b;
            --card-shadow: 0 8px 32px rgba(0,0,0,0.3);
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-secondary: linear-gradient(135deg, #475569 0%, #334155 100%);
            --gradient-accent: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            --border-color: rgba(148, 163, 184, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, 
                #0f172a 0%, 
                #1e293b 50%, 
                #0f172a 100%
            );
            min-height: 100vh;
            color: var(--text-color);
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(248, 113, 113, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(52, 211, 153, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .navbar {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            padding: 1.25rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .navbar-brand i {
            font-size: 1.75rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 6px rgba(99, 102, 241, 0.3));
        }

        .navbar-brand h1 {
            color: var(--text-color);
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .navbar-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .action-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }

        .export-button {
            background: var(--gradient-secondary);
            color: var(--text-color);
        }

        .logout-button {
            background: var(--gradient-accent);
            color: white;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.8);
            padding: 1.75rem;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: white;
        }

        .stat-icon.students {
            background: var(--gradient-primary);
        }

        .stat-icon.faculty {
            background: var(--gradient-secondary);
        }

        .stat-icon.subjects {
            background: var(--gradient-accent);
        }

        .stat-info h3 {
            color: var(--text-color);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
            opacity: 0.8;
        }

        .stat-info p {
            color: var(--text-color);
            font-size: 2rem;
            font-weight: 700;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-button {
            background: rgba(30, 41, 59, 0.8);
            color: var(--text-color);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .tab-button i {
            font-size: 1.1rem;
        }

        .tab-button:hover {
            background: rgba(30, 41, 59, 0.9);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .tab-content {
            display: none;
            background: rgba(30, 41, 59, 0.8);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h2 {
            color: var(--text-color);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .tab-content h2 i {
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-color);
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.6);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .submit-button {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .message {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .success {
            background: rgba(52, 211, 153, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(52, 211, 153, 0.2);
        }

        .error {
            background: rgba(248, 113, 113, 0.1);
            color: var(--accent-color);
            border: 1px solid rgba(248, 113, 113, 0.2);
        }

        .data-content {
            margin-top: 1.5rem;
        }

        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.6);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(15, 23, 42, 0.6);
        }

        .data-table th {
            background: rgba(30, 41, 59, 0.8);
            color: var(--text-color);
            font-weight: 500;
            text-align: left;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover td {
            background: rgba(30, 41, 59, 0.4);
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-active { background: rgba(52, 211, 153, 0.1); color: var(--success-color); }
        .status-completed { background: rgba(148, 163, 184, 0.1); color: var(--secondary-color); }
        .status-upcoming { background: rgba(99, 102, 241, 0.1); color: var(--primary-color); }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .edit-button, .delete-button {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .edit-button:hover {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
        }

        .delete-button:hover {
            background: rgba(248, 113, 113, 0.1);
            color: var(--accent-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            max-width: 500px;
            width: 90%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            color: var(--text-color);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close-button {
            background: none;
            border: none;
            color: var(--secondary-color);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover {
            color: var(--text-color);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .cancel-button, .confirm-button {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }

        .cancel-button {
            background: rgba(30, 41, 59, 0.8);
            color: var(--text-color);
        }

        .confirm-button {
            background: var(--gradient-accent);
            color: white;
        }

        .cancel-button:hover, .confirm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .navbar-actions {
                width: 100%;
                flex-direction: column;
            }

            .action-button {
                width: 100%;
                justify-content: center;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                width: 100%;
                justify-content: center;
            }

            .data-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">
            <i class="fas fa-university"></i>
            <h1>EduLedger Admin</h1>
        </div>
        <div class="navbar-actions">
            <button class="action-button export-button" onclick="exportData()">
                <i class="fas fa-download"></i>
                Export Data
            </button>
            <button class="action-button logout-button" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </button>
        </div>
    </nav>

    <div class="container">
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon students">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <div class="stat-info">
                    <h3>Total Students</h3>
                    <p id="totalStudents">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon faculty">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <div class="stat-info">
                    <h3>Total Faculty</h3>
                    <p id="totalFaculty">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon subjects">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-info">
                    <h3>Active Assignments</h3>
                    <p id="totalAssignments">0</p>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('addStudent')">
                <i class="fas fa-user-plus"></i>
                Add Student
            </button>
            <button class="tab-button" onclick="showTab('addFaculty')">
                <i class="fas fa-user-tie"></i>
                Add Faculty
            </button>
            <button class="tab-button" onclick="showTab('assignFaculty')">
                <i class="fas fa-tasks"></i>
                Assign Faculty
            </button>
            <button class="tab-button" onclick="showTab('viewData')">
                <i class="fas fa-database"></i>
                View Data
            </button>
        </div>

        <div id="addStudent" class="tab-content active">
            <h2>Add New Student</h2>
            <form id="studentForm">
                <div class="form-group">
                    <label for="studentName">Name</label>
                    <input type="text" id="studentName" required>
                </div>
                <div class="form-group">
                    <label for="studentId">Unique ID</label>
                    <input type="text" id="studentId" required>
                </div>
                <div class="form-group">
                    <label for="studentEmail">Email</label>
                    <input type="email" id="studentEmail" required>
                </div>
                <div class="form-group">
                    <label for="studentBranch">Branch</label>
                    <input type="text" id="studentBranch" required>
                </div>
                <div class="form-group">
                    <label for="studentYear">Year</label>
                    <input type="number" id="studentYear" required>
                </div>
                <button type="submit" class="submit-button">Add Student</button>
            </form>
            <div id="studentMessage" class="message"></div>
        </div>

        <div id="addFaculty" class="tab-content">
            <h2>Add New Faculty</h2>
            <form id="facultyForm">
                <div class="form-group">
                    <label for="facultyName">Name</label>
                    <input type="text" id="facultyName" required>
                </div>
                <div class="form-group">
                    <label for="facultyId">Unique ID</label>
                    <input type="text" id="facultyId" required>
                </div>
                <div class="form-group">
                    <label for="facultyEmail">Email</label>
                    <input type="email" id="facultyEmail" required>
                </div>
                <div class="form-group">
                    <label for="facultyResearch">Research Area</label>
                    <input type="text" id="facultyResearch" required>
                </div>
                <div class="form-group">
                    <label for="facultyPost">Post</label>
                    <input type="text" id="facultyPost" required>
                </div>
                <button type="submit" class="submit-button">Add Faculty</button>
            </form>
            <div id="facultyMessage" class="message"></div>
        </div>

        <div id="assignFaculty" class="tab-content">
            <h2>Assign Faculty to Student</h2>
            <form id="assignmentForm">
                <div class="form-group">
                    <label for="studentSelect">Student</label>
                    <select id="studentSelect" required></select>
                </div>
                <div class="form-group">
                    <label for="facultySelect">Faculty</label>
                    <select id="facultySelect" required></select>
                </div>
                <div class="form-group">
                    <label for="subjectSelect">Subject</label>
                    <select id="subjectSelect" required></select>
                </div>
                <div class="form-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" required>
                </div>
                <div class="form-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" required>
                </div>
                <button type="submit" class="submit-button">Assign Faculty</button>
            </form>
            <div id="assignmentMessage" class="message"></div>
        </div>

        <div id="viewData" class="tab-content">
            <h2>View Data</h2>
            <div class="tabs">
                <button class="tab-button active" onclick="showDataTab('students')">Students</button>
                <button class="tab-button" onclick="showDataTab('faculty')">Faculty</button>
                <button class="tab-button" onclick="showDataTab('subjects')">Assigned Subjects</button>
            </div>
            <div id="studentsData" class="data-content">
                <div class="search-container">
                    <input type="text" id="studentSearch" placeholder="Search students..." class="search-input">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Branch</th>
                            <th>Year</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody"></tbody>
                </table>
            </div>
            <div id="facultyData" class="data-content" style="display: none;">
                <div class="search-container">
                    <input type="text" id="facultySearch" placeholder="Search faculty..." class="search-input">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Research Area</th>
                            <th>Post</th>
                        </tr>
                    </thead>
                    <tbody id="facultyTableBody"></tbody>
                </table>
            </div>
            <div id="subjectsData" class="data-content" style="display: none;">
                <div class="search-container">
                    <input type="text" id="subjectSearch" placeholder="Search assignments..." class="search-input">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Faculty</th>
                            <th>Subject</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="subjectsTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal for confirmations -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Confirm Action</h2>
                <button class="close-button" onclick="closeModal()">&times;</button>
            </div>
            <p id="modalMessage">Are you sure you want to perform this action?</p>
            <div class="modal-footer">
                <button class="action-button cancel-button" onclick="closeModal()">Cancel</button>
                <button class="action-button confirm-button" onclick="confirmAction()">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`button[onclick="showTab('${tabId}')"]`).classList.add('active');
        }

        function showDataTab(tabId) {
            document.querySelectorAll('.data-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`${tabId}Data`).style.display = 'block';
            document.querySelector(`button[onclick="showDataTab('${tabId}')"]`).classList.add('active');
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadStudents();
            loadFaculty();
            loadSubjects();
            loadAssignments();
            updateStats();
        });

        // Student form submission
        document.getElementById('studentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const studentData = {
                name: document.getElementById('studentName').value,
                unique_id: document.getElementById('studentId').value,
                email: document.getElementById('studentEmail').value,
                branch: document.getElementById('studentBranch').value,
                year: parseInt(document.getElementById('studentYear').value)
            };

            try {
                const response = await fetch(`${API_BASE_URL}/add_student`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(studentData)
                });

                const result = await response.json();
                showMessage('studentMessage', result.success, result.message);
                
                if (result.success) {
                    loadStudents();
                    document.getElementById('studentForm').reset();
                }
            } catch (error) {
                showMessage('studentMessage', false, 'Error connecting to server');
            }
        });

        // Faculty form submission
        document.getElementById('facultyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const facultyData = {
                name: document.getElementById('facultyName').value,
                unique_id: document.getElementById('facultyId').value,
                email: document.getElementById('facultyEmail').value,
                research_area: document.getElementById('facultyResearch').value,
                post: document.getElementById('facultyPost').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/add_faculty`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(facultyData)
                });

                const result = await response.json();
                showMessage('facultyMessage', result.success, result.message);
                if (result.success) {
                    loadFaculty();
                    document.getElementById('facultyForm').reset();
                }
            } catch (error) {
                showMessage('facultyMessage', false, 'Error adding faculty');
            }
        });

        // Add error handling for fetch requests
        async function fetchWithErrorHandling(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        ...options.headers
                    }
                });

                // Log response details
                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));

                // Check if the response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('Non-JSON response:', text);
                    throw new Error(`Expected JSON response but got ${contentType}`);
                }

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Request failed');
                }

                return data;
            } catch (error) {
                console.error('Fetch error:', error);
                throw error;
            }
        }

        // Update the assignment form submission
        document.getElementById('assignmentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const studentId = document.getElementById('studentSelect').value;
            const facultyId = document.getElementById('facultySelect').value;
            const subjectId = document.getElementById('subjectSelect').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!studentId || !facultyId || !subjectId || !startDate || !endDate) {
                showMessage('assignmentMessage', false, 'Please fill in all fields');
                return;
            }

            const assignmentData = {
                student_id: parseInt(studentId),
                faculty_id: parseInt(facultyId),
                subject_id: parseInt(subjectId),
                start_date: startDate,
                end_date: endDate
            };

            try {
                console.log('Sending assignment request:', assignmentData);
                const result = await fetchWithErrorHandling(`${API_BASE_URL}/assign_faculty`, {
                    method: 'POST',
                    body: JSON.stringify(assignmentData)
                });

                showMessage('assignmentMessage', true, result.message);
                loadAssignments();
                document.getElementById('assignmentForm').reset();
            } catch (error) {
                console.error('Assignment error:', error);
                showMessage('assignmentMessage', false, error.message);
            }
        });

        // Update other fetch calls to use the new function
        async function loadStudents() {
            try {
                const students = await fetchWithErrorHandling(`${API_BASE_URL}/get_students`);
                const tbody = document.getElementById('studentsTableBody');
                tbody.innerHTML = '';
                students.forEach(student => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${student.name}</td>
                        <td>${student.unique_id}</td>
                        <td>${student.email}</td>
                        <td>${student.branch}</td>
                        <td>${student.year}</td>
                    `;
                    tbody.appendChild(tr);
                });

                // Update student select options
                const studentSelect = document.getElementById('studentSelect');
                studentSelect.innerHTML = '';
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.unique_id})`;
                    studentSelect.appendChild(option);
                });

                // Update total students count
                document.getElementById('totalStudents').textContent = students.length;
            } catch (error) {
                console.error('Error loading students:', error);
            }
        }

        async function loadFaculty() {
            try {
                const faculty = await fetchWithErrorHandling(`${API_BASE_URL}/get_faculty`);
                const tbody = document.getElementById('facultyTableBody');
                tbody.innerHTML = '';
                faculty.forEach(faculty => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${faculty.name}</td>
                        <td>${faculty.unique_id}</td>
                        <td>${faculty.email}</td>
                        <td>${faculty.research_area}</td>
                        <td>${faculty.post}</td>
                    `;
                    tbody.appendChild(tr);
                });

                // Update faculty select options
                const facultySelect = document.getElementById('facultySelect');
                facultySelect.innerHTML = '';
                faculty.forEach(faculty => {
                    const option = document.createElement('option');
                    option.value = faculty.id;
                    option.textContent = `${faculty.name} (${faculty.unique_id})`;
                    facultySelect.appendChild(option);
                });

                // Update total faculty count
                document.getElementById('totalFaculty').textContent = faculty.length;
            } catch (error) {
                console.error('Error loading faculty:', error);
            }
        }

        async function loadSubjects() {
            try {
                const subjects = await fetchWithErrorHandling(`${API_BASE_URL}/get_subjects`);
                console.log('Loaded subjects:', subjects);
                
                const subjectSelect = document.getElementById('subjectSelect');
                subjectSelect.innerHTML = '';
                
                subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = `${subject.name} (${subject.code}) - ${subject.credits} credits`;
                    subjectSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading subjects:', error);
            }
        }

        async function loadAssignments() {
            try {
                const assignments = await fetchWithErrorHandling(`${API_BASE_URL}/get_assignments`);
                console.log('Loaded assignments:', assignments);
                
                const tbody = document.getElementById('subjectsTableBody');
                tbody.innerHTML = '';
                
                assignments.forEach(assignment => {
                    const tr = document.createElement('tr');
                    const status = getAssignmentStatus(assignment.start_date, assignment.end_date);
                    tr.innerHTML = `
                        <td>${assignment.student_name} (${assignment.student_id})</td>
                        <td>${assignment.faculty_name} (${assignment.faculty_id})</td>
                        <td>${assignment.subject_name} (${assignment.subject_code}) - ${assignment.subject_credits} credits</td>
                        <td>${formatDate(assignment.start_date)}</td>
                        <td>${formatDate(assignment.end_date)}</td>
                        <td><span class="status-badge status-${status}">${status}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-button edit-button" onclick="viewAssignment(${assignment.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-button delete-button" onclick="deleteAssignment(${assignment.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                updateStats();
            } catch (error) {
                console.error('Error loading assignments:', error);
            }
        }

        function getAssignmentStatus(startDate, endDate) {
            const today = new Date();
            const start = new Date(startDate);
            const end = new Date(endDate);

            if (today < start) return 'upcoming';
            if (today > end) return 'completed';
            return 'active';
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function editAssignment(id) {
            // Implementation for editing assignment
            console.log('Edit assignment:', id);
        }

        function viewAssignment(id) {
            // Find the assignment in the table
            const assignmentRow = document.querySelector(`#subjectsTableBody tr[data-id="${id}"]`);
            if (!assignmentRow) return;

            // Create a modal to display assignment details
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">Assignment Details</h2>
                        <button class="close-button" onclick="this.parentElement.parentElement.parentElement.remove()">&times;</button>
                    </div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <h3>Student Information</h3>
                            <p>Name: ${assignmentRow.cells[0].textContent}</p>
                            <p>Email: ${assignmentRow.cells[0].dataset.email}</p>
                            <p>Branch: ${assignmentRow.cells[0].dataset.branch}</p>
                            <p>Year: ${assignmentRow.cells[0].dataset.year}</p>
                        </div>
                        <div class="detail-item">
                            <h3>Faculty Information</h3>
                            <p>Name: ${assignmentRow.cells[1].textContent}</p>
                            <p>Email: ${assignmentRow.cells[1].dataset.email}</p>
                            <p>Research Area: ${assignmentRow.cells[1].dataset.research}</p>
                            <p>Post: ${assignmentRow.cells[1].dataset.post}</p>
                        </div>
                        <div class="detail-item">
                            <h3>Subject Information</h3>
                            <p>Name: ${assignmentRow.cells[2].textContent}</p>
                            <p>Credits: ${assignmentRow.cells[2].dataset.credits}</p>
                            <p>Start Date: ${assignmentRow.cells[3].textContent}</p>
                            <p>End Date: ${assignmentRow.cells[4].textContent}</p>
                            <p>Status: ${assignmentRow.cells[5].textContent}</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function deleteAssignment(id) {
            showModal('Are you sure you want to delete this assignment?', async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/delete_assignment/${id}`, {
                        method: 'DELETE'
                    });
                    const result = await response.json();
                    if (result.success) {
                        loadAssignments();
                        showMessage('assignmentMessage', true, 'Assignment deleted successfully');
                    } else {
                        showMessage('assignmentMessage', false, 'Error deleting assignment');
                    }
                } catch (error) {
                    showMessage('assignmentMessage', false, 'Error deleting assignment');
                }
            });
        }

        // Add search functionality
        document.getElementById('studentSearch').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#studentsTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('facultySearch').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#facultyTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('subjectSearch').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#subjectsTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        function showMessage(elementId, success, message) {
            const messageElement = document.getElementById(elementId);
            messageElement.textContent = message;
            messageElement.className = `message ${success ? 'success' : 'error'}`;
            messageElement.style.display = 'block';
            
            // Scroll to the message
            messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 3000);
        }

        // Add new functions for enhanced features
        function updateStats() {
            // Get counts from the actual data
            const studentRows = document.querySelectorAll('#studentsTableBody tr');
            const facultyRows = document.querySelectorAll('#facultyTableBody tr');
            const assignmentRows = document.querySelectorAll('#subjectsTableBody tr');

            document.getElementById('totalStudents').textContent = studentRows.length;
            document.getElementById('totalFaculty').textContent = facultyRows.length;
            document.getElementById('totalAssignments').textContent = assignmentRows.length;
        }

        function exportData() {
            const data = {
                students: Array.from(document.querySelectorAll('#studentsTableBody tr')).map(tr => ({
                    name: tr.cells[0].textContent,
                    id: tr.cells[1].textContent,
                    email: tr.cells[2].textContent,
                    branch: tr.cells[3].textContent,
                    year: tr.cells[4].textContent
                })),
                faculty: Array.from(document.querySelectorAll('#facultyTableBody tr')).map(tr => ({
                    name: tr.cells[0].textContent,
                    id: tr.cells[1].textContent,
                    email: tr.cells[2].textContent,
                    research: tr.cells[3].textContent,
                    post: tr.cells[4].textContent
                })),
                assignments: Array.from(document.querySelectorAll('#subjectsTableBody tr')).map(tr => ({
                    student: tr.cells[0].textContent,
                    faculty: tr.cells[1].textContent,
                    subject: tr.cells[2].textContent,
                    startDate: tr.cells[3].textContent,
                    endDate: tr.cells[4].textContent,
                    status: tr.cells[5].textContent
                }))
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'eduledger-data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function logout() {
            window.location.href = '/admin-login';
        }

        function showModal(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">Confirm Action</h2>
                        <button class="close-button" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <p>${message}</p>
                    <div class="modal-buttons">
                        <button class="modal-button cancel" onclick="this.closest('.modal').remove()">Cancel</button>
                        <button class="modal-button confirm" onclick="confirmModal(this)">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Store the onConfirm callback
            modal.querySelector('.confirm').onclick = () => {
                onConfirm();
                modal.remove();
            };
        }

        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        function confirmAction() {
            window.confirmAction();
            closeModal();
        }

        // Add new function for viewing student profile
        function viewStudentProfile(id) {
            // Implementation for viewing student profile
            console.log('View student profile:', id);
        }

        // Add new function for deleting student
        function deleteStudent(id) {
            showModal('Are you sure you want to delete this student?', async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/delete_student/${id}`, {
                        method: 'DELETE'
                    });
                    const result = await response.json();
                    if (result.success) {
                        loadStudents();
                        showMessage('studentMessage', true, 'Student deleted successfully');
                    } else {
                        showMessage('studentMessage', false, 'Error deleting student');
                    }
                } catch (error) {
                    showMessage('studentMessage', false, 'Error deleting student');
                }
            });
        }
    </script>
</body>
</html> 